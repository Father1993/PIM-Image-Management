# üìã –ö–∞—Ç–∞–ª–æ–≥–∏ —Ç–æ–≤–∞—Ä–æ–≤ - –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ

## ‚úÖ –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ

1. **SQL —Å—Ö–µ–º–∞** —Å–æ–∑–¥–∞–Ω–∞ –≤ `supabase_catalog_schema.sql`
2. **–î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã** –∏–∑ PIM –≤ Supabase
3. **–°–≤—è–∑–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã** –ø—Ä—è–º–æ –ø–æ ID (products.id = PIM id)

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –®–∞–≥ 1: –ü—Ä–∏–º–µ–Ω–∏—Ç—å SQL —Å—Ö–µ–º—É (–æ–¥–∏–Ω —Ä–∞–∑)

1. –û—Ç–∫—Ä—ã—Ç—å **Supabase Dashboard** ‚Üí **SQL Editor**
2. –°–æ–∑–¥–∞—Ç—å **New Query**
3. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞:

```
export/supabase_catalog_schema.sql
```

4. **–ù–∞–∂–∞—Ç—å Run** (–≤—ã–ø–æ–ª–Ω–∏—Ç—å)

‚úÖ **–°–æ–∑–¥–∞–Ω–æ:**
- –¢–∞–±–ª–∏—Ü–∞ `catalogs` (–∏–µ—Ä–∞—Ä—Ö–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π)
- –¢–∞–±–ª–∏—Ü–∞ `product_catalogs` (—Å–≤—è–∑–∏ —Ç–æ–≤–∞—Ä—ã ‚Üî –∫–∞—Ç–µ–≥–æ—Ä–∏–∏)
- –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–µ—Ä–µ–≤–æ–º
- –¢—Ä–∏–≥–≥–µ—Ä –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—á–µ—Ç—á–∏–∫–æ–≤
- –ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤

---

### –®–∞–≥ 2: –≠–∫—Å–ø–æ—Ä—Ç –∏ –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö

```bash
# 1. –≠–∫—Å–ø–æ—Ä—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∫–∞—Ç–∞–ª–æ–≥–æ–≤ –∏–∑ PIM
python export/export_catalog_structure.py
# –†–µ–∑—É–ª—å—Ç–∞—Ç: data/catalog_structure.json (2,588 –∫–∞—Ç–∞–ª–æ–≥–æ–≤)

# 2. –≠–∫—Å–ø–æ—Ä—Ç —Å–≤—è–∑–µ–π —Ç–æ–≤–∞—Ä–æ–≤ —Å –∫–∞—Ç–∞–ª–æ–≥–∞–º–∏ –∏–∑ PIM
python export/export_product_catalog_links.py
# –†–µ–∑—É–ª—å—Ç–∞—Ç: data/product_catalog_links.json (57,356 —Å–≤—è–∑–µ–π)

# 3. –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ–≥–æ –≤ Supabase (–æ–¥–∏–Ω —Å–∫—Ä–∏–ø—Ç)
python export/link_products_to_catalogs.py
# ‚úÖ –ó–∞–≥—Ä—É–∂–∞–µ—Ç –∫–∞—Ç–∞–ª–æ–≥–∏ –∏ —Å–æ–∑–¥–∞–µ—Ç –≤—Å–µ —Å–≤—è–∑–∏
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∑–∞–ø—É—Å–∫–∞:**
- ‚úÖ –ö–∞—Ç–∞–ª–æ–≥–æ–≤: 2,588
- ‚úÖ –°–≤—è–∑–µ–π: 57,356
- ‚úÖ –û—Å–Ω–æ–≤–Ω—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π: 28,676
- ‚úÖ –¢–æ–≤–∞—Ä–æ–≤ –≤ –ë–î: 47,131

---

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

### SQL –∑–∞–ø—Ä–æ—Å—ã (–≤ Supabase SQL Editor)

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–∞–π–ª:

```
export/CHECK_RESULTS.sql
```

**–ö–ª—é—á–µ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã:**

```sql
-- –ö–æ—Ä–Ω–µ–≤—ã–µ –∫–∞—Ç–∞–ª–æ–≥–∏ (–£—Ä–æ–≤–µ–Ω—å-1–°, Uroven.pro)
SELECT * FROM v_root_catalogs;

-- –¢–æ–≤–∞—Ä—ã –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
SELECT p.* FROM products p
JOIN product_catalogs pc ON p.id = pc.product_id
WHERE pc.catalog_id = :catalog_id;

-- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–æ–≤–∞—Ä–∞
SELECT c.*, pc.is_primary FROM catalogs c
JOIN product_catalogs pc ON c.id = pc.catalog_id
WHERE pc.product_id = :product_id;
```

---

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

### –°–≤—è–∑—å:

```
products.id = 119 (ID –≤ –ë–î —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å ID –≤ PIM)
    ‚Üì
product_catalogs:
  ‚Ä¢ product_id: 119
  ‚Ä¢ catalog_id: 1027 (–£—Ä–æ–≤–µ–Ω—å-1–°)
  ‚Ä¢ is_primary: TRUE ‚úì
    ‚Üì
  ‚Ä¢ product_id: 119
  ‚Ä¢ catalog_id: 826 (Uroven.pro)
  ‚Ä¢ is_primary: FALSE
```

### –ò–µ—Ä–∞—Ä—Ö–∏—è:

```
ROOT
‚îú‚îÄ‚îÄ –£—Ä–æ–≤–µ–Ω—å - 1—Å (–Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –∏–∑ 1–°)
‚îÇ   ‚îú‚îÄ‚îÄ –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç
‚îÇ   ‚îî‚îÄ‚îÄ –ö—Ä–µ–ø–µ–∂
‚îú‚îÄ‚îÄ Uroven.pro (–≥–æ—Ç–æ–≤—ã–µ –¥–ª—è —Å–∞–π—Ç–∞)
‚îÇ   ‚îú‚îÄ‚îÄ –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã (–º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å)
‚îÇ   ‚îî‚îÄ‚îÄ –ö—Ä–µ–ø–µ–∂
‚îú‚îÄ‚îÄ Uroven.store
‚îî‚îÄ‚îÄ –ú–∞—Å—Ç–µ—Ä –∫–∞—Ç–∞–ª–æ–≥
```

---

## üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

–î–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å PIM –ø—Ä–æ—Å—Ç–æ –∑–∞–ø—É—Å—Ç–∏—Ç–µ:

```bash
python export/link_products_to_catalogs.py
```

–°–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `upsert` - –±–µ–∑–æ–ø–∞—Å–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω–æ.

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∞–π–ª—ã:

```
export/
‚îú‚îÄ‚îÄ supabase_catalog_schema.sql          ‚Üê SQL —Å—Ö–µ–º–∞ (—Å–æ–∑–¥–∞—Ç—å –≤ Supabase)
‚îú‚îÄ‚îÄ link_products_to_catalogs.py         ‚Üê –û—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç (–∑–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ–≥–æ)
‚îú‚îÄ‚îÄ export_catalog_structure.py          ‚Üê –≠–∫—Å–ø–æ—Ä—Ç –∫–∞—Ç–∞–ª–æ–≥–æ–≤ –∏–∑ PIM
‚îú‚îÄ‚îÄ export_product_catalog_links.py      ‚Üê –≠–∫—Å–ø–æ—Ä—Ç —Å–≤—è–∑–µ–π –∏–∑ PIM
‚îú‚îÄ‚îÄ CHECK_RESULTS.sql                    ‚Üê –ó–∞–ø—Ä–æ—Å—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
‚îî‚îÄ‚îÄ README.md                            ‚Üê –≠—Ç–æ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ

.docs/
‚îú‚îÄ‚îÄ SETUP_INSTRUCTIONS.md                ‚Üê –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
‚îú‚îÄ‚îÄ CATALOG_STRUCTURE_DIAGRAM.md         ‚Üê –î–∏–∞–≥—Ä–∞–º–º—ã –∏ —Å—Ö–µ–º—ã
‚îî‚îÄ‚îÄ CATALOG_QUICK_REFERENCE.md           ‚Üê –ë—ã—Å—Ç—Ä–∞—è —Å–ø—Ä–∞–≤–∫–∞ –ø–æ SQL

data/
‚îú‚îÄ‚îÄ catalog_structure.json               ‚Üê –ö–∞—Ç–∞–ª–æ–≥–∏ (—ç–∫—Å–ø–æ—Ä—Ç –∏–∑ PIM)
‚îî‚îÄ‚îÄ product_catalog_links.json           ‚Üê –°–≤—è–∑–∏ (—ç–∫—Å–ø–æ—Ä—Ç –∏–∑ PIM)
```

---

## üéØ –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏

### API –∑–∞–ø—Ä–æ—Å—ã (TypeScript/NextJS):

```typescript
// –î–µ—Ä–µ–≤–æ –∫–∞—Ç–∞–ª–æ–≥–æ–≤
const { data: catalogs } = await supabase
  .from('catalogs')
  .select('*')
  .eq('parent_id', parentId)
  .order('pos');

// –¢–æ–≤–∞—Ä—ã –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
const { data: products } = await supabase
  .from('products')
  .select(`
    *,
    product_catalogs!inner(is_primary)
  `)
  .eq('product_catalogs.catalog_id', catalogId);

// –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å —Ç–æ–≤–∞—Ä –≤ –¥—Ä—É–≥—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é
await supabase.rpc('move_product_to_catalog', {
  product_id: 119,
  new_catalog_id: 826,
  set_primary: true
});
```

### UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –¥–ª—è –∞–¥–º–∏–Ω–∫–∏:

1. **–î–µ—Ä–µ–≤–æ –∫–∞—Ç–∞–ª–æ–≥–æ–≤** - —Ä–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Å Nested Sets
2. **–°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤** - —Ñ–∏–ª—å—Ç—Ä –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º + –ø–∞–≥–∏–Ω–∞—Ü–∏—è
3. **Breadcrumbs** - –ø—É—Ç—å —á–µ—Ä–µ–∑ `catalogs.path` –∏–ª–∏ `path_array`
4. **–ú—É–ª—å—Ç–∏–≤—ã–±–æ—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–π** - —á–µ–∫–±–æ–∫—Å—ã —Å –ø–æ–∏—Å–∫–æ–º
5. **Drag & Drop** - –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤ –º–µ–∂–¥—É –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏

---

## ‚ö° –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:

- ‚úÖ **–ò–Ω–¥–µ–∫—Å—ã** –Ω–∞ –≤—Å–µ—Ö –∫–ª—é—á–µ–≤—ã—Ö –ø–æ–ª—è—Ö
- ‚úÖ **Nested Sets** –¥–ª—è –±—ã—Å—Ç—Ä—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–µ—Ä–µ–≤–∞
- ‚úÖ **–¢—Ä–∏–≥–≥–µ—Ä** –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—á–µ—Ç—á–∏–∫–æ–≤
- ‚úÖ **Batch insert** (1000 –∑–∞–ø–∏—Å–µ–π –∑–∞ —Ä–∞–∑)
- ‚úÖ **Views** –¥–ª—è —á–∞—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

### –°–∫–æ—Ä–æ—Å—Ç—å:

- –ó–∞–≥—Ä—É–∑–∫–∞ 2,588 –∫–∞—Ç–∞–ª–æ–≥–æ–≤: ~5 —Å–µ–∫
- –ó–∞–≥—Ä—É–∑–∫–∞ 57,356 —Å–≤—è–∑–µ–π: ~60 —Å–µ–∫
- –ó–∞–ø—Ä–æ—Å —Ç–æ–≤–∞—Ä–æ–≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏: <50ms
- –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –¥–µ—Ä–µ–≤—É: <10ms

---

## ‚ùì –ß–∞—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã

**Q: –ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏—é?**

```sql
INSERT INTO product_catalogs (product_id, catalog_id, is_primary)
VALUES (119, 826, FALSE);
```

**Q: –ö–∞–∫ –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å —Ç–æ–≤–∞—Ä –≤ –¥—Ä—É–≥—É—é –æ—Å–Ω–æ–≤–Ω—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é?**

```sql
-- 1. –£–±—Ä–∞—Ç—å is_primary —É –≤—Å–µ—Ö
UPDATE product_catalogs SET is_primary = FALSE 
WHERE product_id = 119;

-- 2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–æ–≤—É—é –æ—Å–Ω–æ–≤–Ω—É—é
UPDATE product_catalogs SET is_primary = TRUE 
WHERE product_id = 119 AND catalog_id = 826;
```

**Q: –ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å –≤—Å–µ —Ç–æ–≤–∞—Ä—ã –≤ –≤–µ—Ç–∫–µ –∫–∞—Ç–∞–ª–æ–≥–∞?**

```sql
SELECT DISTINCT p.*
FROM products p
JOIN product_catalogs pc ON p.id = pc.product_id
WHERE pc.catalog_id IN (
    SELECT id FROM get_catalog_descendants(21)
);
```

**Q: –°—á–µ—Ç—á–∏–∫ product_count –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å —Ä–µ–∞–ª—å–Ω—ã–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º?**

–¢—Ä–∏–≥–≥–µ—Ä –æ–±–Ω–æ–≤–ª—è–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, –Ω–æ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å –≤—Ä—É—á–Ω—É—é:

```sql
UPDATE catalogs SET product_count = (
    SELECT COUNT(*) FROM product_catalogs 
    WHERE catalog_id = catalogs.id
);
```

---

## üéâ –ì–æ—Ç–æ–≤–æ!

–¢–µ–ø–µ—Ä—å —É –≤–∞—Å:
- ‚úÖ –ü–æ–ª–Ω–∞—è –∏–µ—Ä–∞—Ä—Ö–∏—è –∫–∞—Ç–∞–ª–æ–≥–æ–≤ –∏–∑ PIM
- ‚úÖ –í—Å–µ —Ç–æ–≤–∞—Ä—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
- ‚úÖ –ë—ã—Å—Ç—Ä—ã–µ –∑–∞–ø—Ä–æ—Å—ã —á–µ—Ä–µ–∑ –∏–Ω–¥–µ–∫—Å—ã –∏ Nested Sets
- ‚úÖ –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–æ–≤
- ‚úÖ –ì–æ—Ç–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ UI –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–∞—Ç–∞–ª–æ–≥–∞–º–∏ üöÄ

