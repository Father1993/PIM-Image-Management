# üöÄ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–∞—Ç–∞–ª–æ–≥–æ–≤

## –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å

**–†–∞–Ω—å—à–µ:** –°–≤—è–∑—å —á–µ—Ä–µ–∑ `code_1c` (—Å–ª–æ–∂–Ω–æ, –º–µ–¥–ª–µ–Ω–Ω–æ)  
**–°–µ–π—á–∞—Å:** –ü—Ä—è–º–∞—è —Å–≤—è–∑—å `products.id` = `PIM product.id` (–ø—Ä–æ—Å—Ç–æ, –±—ã—Å—Ç—Ä–æ)

---

## –®–∞–≥ 1: –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã –≤ Supabase

### –ß–µ—Ä–µ–∑ SQL Editor –≤ Supabase Dashboard:

1. –û—Ç–∫—Ä—ã—Ç—å **SQL Editor**
2. –°–æ–∑–¥–∞—Ç—å **New Query**
3. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ `export/supabase_catalog_schema.sql`
4. **–í—ã–ø–æ–ª–Ω–∏—Ç—å (Run)**

**–°–æ–∑–¥–∞—é—Ç—Å—è:**
- ‚úÖ –¢–∞–±–ª–∏—Ü–∞ `catalogs` (–∏–µ—Ä–∞—Ä—Ö–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π)
- ‚úÖ –¢–∞–±–ª–∏—Ü–∞ `product_catalogs` (—Å–≤—è–∑–∏ —Ç–æ–≤–∞—Ä—ã ‚Üî –∫–∞—Ç–µ–≥–æ—Ä–∏–∏)
- ‚úÖ –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–µ—Ä–µ–≤–æ–º
- ‚úÖ –¢—Ä–∏–≥–≥–µ—Ä –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—á–µ—Ç—á–∏–∫–æ–≤
- ‚úÖ –ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –¥–ª—è —É–¥–æ–±–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

---

## –®–∞–≥ 2: –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ PIM

```bash
# 1. –≠–∫—Å–ø–æ—Ä—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∫–∞—Ç–∞–ª–æ–≥–æ–≤
python export/export_catalog_structure.py

# –†–µ–∑—É–ª—å—Ç–∞—Ç: data/catalog_structure.json
# –°–æ–¥–µ—Ä–∂–∏—Ç: –£—Ä–æ–≤–µ–Ω—å-1–°, Uroven.pro, –ú–∞—Å—Ç–µ—Ä –∫–∞—Ç–∞–ª–æ–≥ –∏ —Ç.–¥.

# 2. –≠–∫—Å–ø–æ—Ä—Ç —Å–≤—è–∑–µ–π —Ç–æ–≤–∞—Ä–æ–≤ —Å –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏
python export/export_product_catalog_links.py

# –†–µ–∑—É–ª—å—Ç–∞—Ç: data/product_catalog_links.json
# –°–æ–¥–µ—Ä–∂–∏—Ç: –≤—Å–µ —Å–≤—è–∑–∏ product_id ‚Üî catalog_id
```

---

## –®–∞–≥ 3: –ó–∞–≥—Ä—É–∑–∏—Ç—å –≤ Supabase

```bash
# –ó–∞–≥—Ä—É–∑–∏—Ç—å –≤—Å—ë –æ–¥–Ω–∏–º —Å–∫—Ä–∏–ø—Ç–æ–º
python export/link_products_to_catalogs.py
```

**–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:**
1. ‚úÖ –ó–∞–≥—Ä—É–∂–∞–µ—Ç –∫–∞—Ç–∞–ª–æ–≥–∏ –≤ –ë–î
2. ‚úÖ –°–æ–∑–¥–∞–µ—Ç —Å–≤—è–∑–∏ —Ç–æ–≤–∞—Ä—ã ‚Üî –∫–∞—Ç–∞–ª–æ–≥–∏
3. ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç
4. ‚úÖ –í—ã–≤–æ–¥–∏—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

### SQL –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:

```sql
-- 1. –°–∫–æ–ª—å–∫–æ –∫–∞—Ç–∞–ª–æ–≥–æ–≤ –∑–∞–≥—Ä—É–∂–µ–Ω–æ?
SELECT COUNT(*) FROM catalogs;

-- 2. –ö–æ—Ä–Ω–µ–≤—ã–µ –∫–∞—Ç–∞–ª–æ–≥–∏ (–£—Ä–æ–≤–µ–Ω—å-1–°, Uroven.pro)
SELECT * FROM v_root_catalogs;

-- 3. –°–∫–æ–ª—å–∫–æ —Å–≤—è–∑–µ–π —Ç–æ–≤–∞—Ä—ã‚Üî–∫–∞—Ç–µ–≥–æ—Ä–∏–∏?
SELECT COUNT(*) FROM product_catalogs;

-- 4. –¢–æ–≤–∞—Ä—ã –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ "–£—Ä–æ–≤–µ–Ω—å-1–°"
SELECT COUNT(*) FROM product_catalogs
WHERE catalog_id = (SELECT id FROM catalogs WHERE header = '–£—Ä–æ–≤–µ–Ω—å - 1—Å');

-- 5. –¢–æ–≤–∞—Ä—ã –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ "Uroven.pro"
SELECT COUNT(*) FROM product_catalogs
WHERE catalog_id = (SELECT id FROM catalogs WHERE header = 'Uroven.pro');
```

---

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –°–≤—è–∑—å —Ç–æ–≤–∞—Ä–æ–≤:

```
products.id = 119 (ID –≤ –ë–î = ID –≤ PIM)
    ‚Üì
product_catalogs:
  - product_id=119, catalog_id=1027, is_primary=TRUE  (1–°)
  - product_id=119, catalog_id=826, is_primary=FALSE  (Uroven.pro)
```

### –ò–µ—Ä–∞—Ä—Ö–∏—è –∫–∞—Ç–∞–ª–æ–≥–æ–≤:

```
–£—Ä–æ–≤–µ–Ω—å - 1—Å (id=X, level=2) ‚Üê –ù–æ–≤—ã–µ —Ç–æ–≤–∞—Ä—ã –∏–∑ 1–°
  ‚îú‚îÄ‚îÄ –ö–∞—Ç–µ–≥–æ—Ä–∏—è 1 (level=3)
  ‚îî‚îÄ‚îÄ –ö–∞—Ç–µ–≥–æ—Ä–∏—è 2 (level=3)

Uroven.pro (id=21, level=2) ‚Üê –û–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã –¥–ª—è —Å–∞–π—Ç–∞
  ‚îú‚îÄ‚îÄ –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã (level=3)
  ‚îÇ   ‚îî‚îÄ‚îÄ –≠–ª–µ–∫—Ç—Ä–æ–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç (level=4)
  ‚îî‚îÄ‚îÄ –ö—Ä–µ–ø–µ–∂ (level=3)
```

---

## –ß–∞—Å—Ç—ã–µ –∑–∞–ø—Ä–æ—Å—ã

### –¢–æ–≤–∞—Ä—ã –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:

```sql
SELECT p.* FROM products p
JOIN product_catalogs pc ON p.id = pc.product_id
WHERE pc.catalog_id = :category_id;
```

### –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–æ–≤–∞—Ä–∞:

```sql
SELECT c.*, pc.is_primary FROM catalogs c
JOIN product_catalogs pc ON c.id = pc.catalog_id
WHERE pc.product_id = :product_id;
```

### –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å —Ç–æ–≤–∞—Ä –≤ –¥—Ä—É–≥—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é:

```sql
-- –£–±—Ä–∞—Ç—å –æ—Å–Ω–æ–≤–Ω—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é
UPDATE product_catalogs SET is_primary = FALSE 
WHERE product_id = :id AND is_primary = TRUE;

-- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–æ–≤—É—é –æ—Å–Ω–æ–≤–Ω—É—é
UPDATE product_catalogs SET is_primary = TRUE 
WHERE product_id = :id AND catalog_id = :new_catalog_id;
```

### –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä –≤ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é:

```sql
INSERT INTO product_catalogs (product_id, catalog_id, is_primary, sort_order)
VALUES (:product_id, :catalog_id, FALSE, 1)
ON CONFLICT (product_id, catalog_id) DO NOTHING;
```

---

## –î–ª—è –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤

### Workflow –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤:

1. **–¢–æ–≤–∞—Ä –ø—Ä–∏—Ö–æ–¥–∏—Ç –∏–∑ 1–°** ‚Üí –ø–æ–ø–∞–¥–∞–µ—Ç –≤ "–£—Ä–æ–≤–µ–Ω—å - 1—Å"
2. **–ú–µ–Ω–µ–¥–∂–µ—Ä –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç** ‚Üí –ø—Ä–∏—Å–≤–∞–∏–≤–∞–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –≤ "Uroven.pro"
3. **–¢–æ–≤–∞—Ä –≤—ã–≥—Ä—É–∂–∞–µ—Ç—Å—è –Ω–∞ —Å–∞–π—Ç** —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∏–µ—Ä–∞—Ä—Ö–∏–µ–π

### –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å:

- ‚úÖ –î–µ—Ä–µ–≤–æ –≤—Å–µ—Ö –∫–∞—Ç–∞–ª–æ–≥–æ–≤
- ‚úÖ –¢–µ–∫—É—â–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–æ–≤–∞—Ä–∞
- ‚úÖ –û—Å–Ω–æ–≤–Ω—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é (–æ—Ç–º–µ—á–µ–Ω–∞)
- ‚úÖ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –¥–æ–±–∞–≤–∏—Ç—å/—É–¥–∞–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
- ‚úÖ Breadcrumbs –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏

---

## –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

```bash
# –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—É—Å–∫ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ (upsert)
python export/link_products_to_catalogs.py

# –°–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç upsert - –±–µ–∑–æ–ø–∞—Å–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω–æ
```

---

## –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **SQL —Å—Ö–µ–º–∞:** `export/supabase_catalog_schema.sql`
- **–°–∫—Ä–∏–ø—Ç —Å–≤—è–∑—ã–≤–∞–Ω–∏—è:** `export/link_products_to_catalogs.py`
- **AI –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:** `.docs/CATALOG_STRUCTURE_AI_GUIDE.md`
- **–ë—ã—Å—Ç—Ä–∞—è —Å–ø—Ä–∞–≤–∫–∞:** `.docs/CATALOG_QUICK_REFERENCE.md`

---

**–ì–æ—Ç–æ–≤–æ!** –¢–µ–ø–µ—Ä—å –∫–∞—Ç–∞–ª–æ–≥–∏ —Ä–∞–±–æ—Ç–∞—é—Ç —Ç–∞–∫ –∂–µ, –∫–∞–∫ –≤ PIM. üéØ

