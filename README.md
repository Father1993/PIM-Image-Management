# üñºÔ∏è PIM Image Optimizer —á–µ—Ä–µ–∑ imgproxy

–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Ç–æ–≤–∞—Ä–æ–≤: PIM ‚Üí imgproxy ‚Üí PIM

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –°–æ–∑–¥–∞–π—Ç–µ —Ç–∞–±–ª–∏—Ü—É –≤ Supabase

–í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL –∏–∑ —Ñ–∞–π–ª–∞ `create_product_images_table.sql`

### 2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –≤ —Ä–µ–∂–∏–º–µ preview

```bash
# –¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º - –æ–±—Ä–∞–±–æ—Ç–∞–µ—Ç 1-5 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
python optimized.py preview
```

### 3. –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª –æ–±—Ä–∞–±–æ—Ç–∫–∏

```bash
# –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
python optimized.py scan

# –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ imgproxy
python optimized.py optimize

# –ó–∞–≥—Ä—É–∑–∫–∞ –æ–±—Ä–∞—Ç–Ω–æ –≤ PIM
python optimized.py upload

# –ò–ª–∏ –≤—Å–µ —Å—Ä–∞–∑—É
python optimized.py full
```

## üìã –†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã

-   **preview** - —Ç–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º –¥–ª—è 1-5 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Å –≤—ã–≤–æ–¥–æ–º ID —Ç–æ–≤–∞—Ä–æ–≤
-   **scan** - —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ product_backup –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ product_images
-   **optimize** - –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —á–µ—Ä–µ–∑ imgproxy (750x1000px, JPEG, 85%)
-   **upload** - –∑–∞–≥—Ä—É–∑–∫–∞ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤ PIM
-   **full** - –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª (scan ‚Üí optimize ‚Üí upload)
-   **test** - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã imgproxy

## üîß –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ø–æ–ª—É—á–∞–µ—Ç –≤—Å–µ —Ç–æ–≤–∞—Ä—ã –∏–∑ `product_backup`, –∏–∑–≤–ª–µ–∫–∞–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ —Ç–∞–±–ª–∏—Ü—É `product_images`
2. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è**: –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —á–µ—Ä–µ–∑ imgproxy —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏:
    - –®–∏—Ä–∏–Ω–∞: 750px
    - –í—ã—Å–æ—Ç–∞: 1000px (—Å –±–µ–ª—ã–º —Ñ–æ–Ω–æ–º)
    - –§–æ—Ä–º–∞—Ç: JPEG
    - –ö–∞—á–µ—Å—Ç–≤–æ: 85%
3. **–ó–∞–≥—Ä—É–∑–∫–∞**: –∑–∞–≥—Ä—É–∂–∞–µ—Ç –Ω–æ–≤—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ PIM –∏ —É–¥–∞–ª—è–µ—Ç —Å—Ç–∞—Ä—ã–µ

## üìä –¢–∞–±–ª–∏—Ü–∞ product_images

–û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å –∫–∞–∂–¥–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:

-   `is_downloaded` - —Å–∫–∞—á–∞–Ω–æ (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏)
-   `is_optimized` - –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ —á–µ—Ä–µ–∑ imgproxy
-   `is_uploaded` - –∑–∞–≥—Ä—É–∂–µ–Ω–æ –æ–±—Ä–∞—Ç–Ω–æ –≤ PIM

## üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞

```sql
-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏
SELECT
    COUNT(*) as total,
    SUM(CASE WHEN is_optimized THEN 1 ELSE 0 END) as optimized,
    SUM(CASE WHEN is_uploaded THEN 1 ELSE 0 END) as uploaded
FROM product_images;

-- –ù–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
SELECT product_id, image_name, image_type
FROM product_images
WHERE NOT is_optimized
LIMIT 10;
```
